# Docker_test
## Установка Docker и Docker compose

### Для подготовки к установке Docker необходимо выполнить следующие действия:
 Обновите индекса пакетов с помощью команды 
 ```bash
  sudo apt-get update
 ```
 Выполните установку пакетов с помощью команды
 ```bash
 sudo apt-get install ca-certificates curl gnupg
 ```
Добавьте GPG-ключ в Docker с помощью команд:
```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```
Добавльте репозиторий Docker в источники Apt с помощью команд :
```bash 
echo \ "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
"$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \ 
sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```
Обновление индекса пакетов с помощью команды sudo apt-get update:
Результат последовательного выполнения команд представлен на рисунке 1.

Рисунок 1 Подготовка к установке docker
Выполним установку docker. Для этого введем команду 
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin. 
Результат выполнения команды представлен на рисунке 2
Рисунок  2 . Процесс установки docker

Для проверки правильности установки запущена команда sudo docker run hello-world. Результат установки представлен на рисунке 3.

Рисунок  3 . Результат вызова команды docker run hello-world
Выполним настройку Docker для работы без прав root (добавим пользователя в группу docker). Для этого выполним следующие действия:
 Создадим Unix-группу пользователей с именем docker с помощью команды sudo groupadd docker
После этого добавим пользователя $USER в группу docker с помощью команды 
sudo usermod -aG docker $USER
Далее выполним активацию изменений с помощью команды newgrp docker
Результат выполнения команд, приведенных в п. 1 - 3 представлен на рисунке 4

Рисунок 4.  Добавление пользователя в группу и активация изменений. 
Выполним проверку добавления пользователя в группу docker с помощью команды docker run hello-world как показано на рисунке 5.

Рисунок  5.  Выполнение тестовой проверки запуска докера.
Как видно, запуск прошел успешно. Выполнение  команды от имени суперпользователя (ввод sudo) теперь не требуется. 


Выполним установку Docker Compose. 
Для этого выполним следующие действия:
Запустим команду sudo curl -L "https://github.com/docker/compose/releases/download/v2.23.0/docker-compose-linux-x86_64" -o /usr/local/bin/docker-compose
для загрузки версии 2.23.0 и сохранения исполняемого файл в папку /usr/local/bin/docker-compose. 
2.   Установим права на исполнение для файла docker-compose с помощью команды sudo chmod +x /usr/local/bin/docker-compose
3.    Проверим корректность установки с помощью команды 
    docker-compose --version
Результаты выполнения команд представлены на рисунке 6. 

 Рисунок 6. Последовательность установки Docker Compose
 Как видно из рис.6, установка выполнена корректно.

Разработка программы на языке Python для дальнейшей работы в Docker
Разработана программа для расчета траектории тела,брошенного под углом к горизонту при заданной начальной скорости. Текст программы представлен в репозитории проекта. Результат работы программы представлен на рисунке 7.

Рисунок 7. Результат запуска программы в среде VS Code
Выполненное тестирование показало работоспособность программы.
Создание Docker образа для программы
Создание Docker образа выполним следующим образом:
Создадим директорию Docker test c помощью команды 
mkdir Docker_test и перейдем в нее с помощью команды        cd Docker_test
С помощью команды touch Dockerfile cоздадим файл с инструкциями для Docker. Содержимое файла представлено на рисунке 8. 

Рисунок 8. Содержимое файла Dockerfile
Рассмотрим подробнее содержимое файла Dockerfile:
Инструкция FROM python:3.8-slim предназначена для определения базового образа, на котором будет строиться текущий образ, а именно python 3.8-slim, имеющий несколько меньший объем, чем python 3.8
Инструкция WORKDIR /app создает рабочий каталог app внутри контейнера. 
Инструкция COPY . /app копирует содержимое папки в директорию app
Инструкция RUN python -m pip install numpy simpy matplotlib scipy устанавливает пакеты numpy, simpy, mathplotlib, scipy для работы файла final-task2.py.
Инструкция ENV MPLBACKEND=Agg устанавливает переменную окружающей среды и настраивает бэкенд для вывода графика. В данном случае получилось вывести график, который строит matplotlib,  в отдельный файл, который называется myfile.png. Для этого необходимо внести изменения в файл программы, а именно: добавить строки import matplotlib и matplotlib.use('Agg') для использования бэкенда Agg, а также вместо plt.show необходимо добавить строку plt.savefig('/app/myplot.png') для записи рисунка в файл в директории app. 
Инструкция CMD [ "python", "final_task2.py" ] запускает скрипт final-task2.py.
Соберем докер образ с помощью команды 
docker build -t docker_test:mydocker . 
команда -t присваивает имя и тэг собираемому контейнеру. В данном случае контейнеру присвоено имя  docker_test и тэг mydocker.

Рисунок 9. Процесс сборки образа
По окончании сборки будет выведено сообщение FINISHED

Рисунок 10. Окончание сборки образа
С помощью команды docker image ls убедимся в том, что создан docker образ

Рисунок 11 Выполнение команды docker image ls и вывод имеющихся образов
4. Запуск и тестирование приложения в Docker контейнере
Выполним запуск приложения в докер контейнере с помощью команды 
docker run -v $(pwd):/app docker_test:mydocker. 
Флаг -v $(pwd):/app монтирует текущую рабочую директорию  в директорию /app внутри контейнера, позволяя получить доступ к рисунку. 

Рисунок 12. Запуск докера
После запуска докера программа вывела в терминал Done. В тексте программы для этого была добавлена строка print (“Done”). В рабочей директории ~/Docker_test/new_docker создан файл myfile.png, содержащий график matplotlib как показано на рисунке 13.  

Рисунок 13. Созданный рисунок в рабочей директории
Запуск контейнера показал работоспособность программы при запуске образа.
5. Работа в Docker compose
Выполним создание docker-compose.yml для запуска docker контейнера с программой с помощью редактора nano. Содержимое файла представлено на рисунке 14.

Рисунок 14. Содержимое файла docker-compose.yml

Рассмотрим содержимое файла:
version версия 2
services: - основной раздел, где создаются и описываются сервисы (контейнеры docker). В данном примере сервис один. Он имеет имя container
image: имя готового образа, который будет использоваться для создания контейнера. Он был собран ранее и имеет имя docker_test и тэг mydocker
volumes: монтирование папок. Здесь монтируется локальный каталог ~/Docker_test/new_docker на хосте внутрь контейнера в качестве каталога /app.
environment: переменные окружения. Выполняется настройка бэкэнда. Переменной MPLBACKEND присвоено значение Agg.
	
Для запуска контейнера выполним команду docker-compose up. Результат выполнения команды представлен на рисунке 15.

Рисунок 15. Результат выполнения команды docker-compose up

В результате работы программы в папке ~/Docker_test/new_docker был создан файл с графиком. 






